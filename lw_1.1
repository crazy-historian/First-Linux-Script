#!/bin/bash
<<<<<<< HEAD
# третья версия скрипта
=======

# ---  вторая версия скрипта ---
# --- created by crazy_historian ----
>>>>>>> 04c0e65adcd98582e01f94a07c6c2b2e5f7823c4

# $1 - ключ, обозначающий приоритет
# $2 - исходная директория
# $3 - директория назначения

<<<<<<< HEAD
# проверка флага, обозначающий приоритет директории
flag=0 # стандартный приоритет

while [ -n "$1" ]; do
	case "$1" in
	-p) echo "Приоритет директории назначения"
		flag=1 ;;
	--) shift
	break ;;
	esac
	shift
done
echo "Флаг: $flag, исходная директория: $1, директория назначения: $2"

# проверка переданных директорий
if [ ! -d $1 ] 
	then
    echo "Исходной директории не существует, создаем её"
	mkdir $1
	flag=1
	exit 1
elif [ "$(ls -A "$1" 2> /dev/null)" == "" ]; then
	echo "Исходная директория пуста, установка приоритета"
	flag=1
elif [ ! -d $2 ]
	then
    echo "Директории назначения не существует, создание ..."
	# создание директории назначения
	mkdir $2
else
	echo "Все замечательно "	
=======
# echo запросы должны быть в итоге удалены,
# они несут отладочный характер

# проверка переданных аргументов
if [ ! -d $2 ] ; then
	# создание исходной директории
	# (!) полное копирование в случае пустой директории (!)
	echo "Исходная директория отсутствует, создание ..."
	mkdir $2
elif [ ! -d $3 ] ; then
	# создание директории назначения
	echo "Директория назначения отсутствует, создание ..." 
	mkdir $3
>>>>>>> 04c0e65adcd98582e01f94a07c6c2b2e5f7823c4
fi 

my_copy() {
	echo "Мы находимся в директории $1, директория назначения $2"

<<<<<<< HEAD
	for source_file in $1/*; do
		target_file=$2/$(basename $source_file)  #  адрес файла в дир. назначения
		echo "$target_file, адрес файла в дир. назначения"
		if [ -d $source_file ] && [ ! -d $target_file ]; then
			mkdir $target_file
			my_copy $source_file $target_file
=======
# цикл по исходной директории
for file in $1/*
do
	echo "Имя файла $(basename $file)" 
>>>>>>> 04c0e65adcd98582e01f94a07c6c2b2e5f7823c4

		elif [ -d $target_file ]; then
			my_copy $source_file $target_file

<<<<<<< HEAD
		elif [ -f $source_file ]; then
			# 1) безусловное копирование
			if [ ! -f $target_file ]; then
				echo "Безусловное копирование"
				cp $source_file $2 
			else 
				source_seconds=$(date +%s -r $source_file)
				target_seconds=$(date +%s -r $target_file)
				difference=$(($source_seconds - $target_seconds))
				echo "Разница в секундах, $difference"
				# 2) копирование с заменой
				if [ $source_seconds -gt $target_seconds ]; then
					echo "Копирование с заменой"
					cp $source_file $2
				# 3) копирование с проверкой приоритета директории
				elif [ $source_seconds -lt $target_seconds ] && [ $flag -eq 1 ]; then
				echo "Копирование с заменой и проверкой приоритета"
					cp $target_file $1
				fi
			fi
		fi
	done
}

my_copy $1 $2
=======
	if [ ! -f $flash_file ] ; then 
		echo "Файла нет в директори назначения, копирование..."
		cp $file $2

	# файл есть в директории назначения и он редактирован позже, чем в исходной
	elif [ -f $flash_file ] && [ $(ls -l $file) lt $(ls -l $flash_file) ] ; then
		cp $file $2
		echo "Файл был обновлен, копирование ..."

	# файл есть в директории назначения и он отредактирован раньше, чем в исходной
	elif [ $(ls -l $file) qt $(ls -l $flash_file) ] && [ $flag -eq 1]; then
		echo "Использван приоритет директории, обновление ..."
		cp $file $2	fi                                                                                                                                     
done
>>>>>>> 04c0e65adcd98582e01f94a07c6c2b2e5f7823c4




                                                     
